â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CHATBOT SANTOS - ARQUITECTURA                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FLUJO COMPLETO                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    USUARIO                    FRONTEND                    BACKEND
      â”‚                          â”‚                           â”‚
      â”‚  1. Clic en botÃ³n        â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
      â”‚                          â”‚                           â”‚
      â”‚  2. Escribe mensaje      â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
      â”‚                          â”‚                           â”‚
      â”‚                          â”‚  3. POST /api/chat        â”‚
      â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                          â”‚  {message, sessionId}     â”‚
      â”‚                          â”‚                           â”‚
      â”‚                          â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
      â”‚                          â”‚                    â”‚ Rate Limit  â”‚
      â”‚                          â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                          â”‚                           â”‚
      â”‚                          â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
      â”‚                          â”‚                    â”‚ Validator   â”‚
      â”‚                          â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                          â”‚                           â”‚
      â”‚                          â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                          â”‚                    â”‚ Session Manager â”‚
      â”‚                          â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                          â”‚                           â”‚
      â”‚                          â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                          â”‚                    â”‚ Intent Engine  â”‚
      â”‚                          â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                          â”‚                           â”‚
      â”‚                          â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                          â”‚           â”‚                            â”‚
      â”‚                          â”‚    Predefinida?                  No â†’ OpenAI
      â”‚                          â”‚           â”‚                            â”‚
      â”‚                          â”‚          SÃ­                            â”‚
      â”‚                          â”‚           â”‚                            â”‚
      â”‚                          â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                          â”‚                        â”‚
      â”‚                          â”‚  4. Response           â”‚
      â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                          â”‚  {message, sessionId}  â”‚
      â”‚                          â”‚                        â”‚
      â”‚  5. Muestra respuesta    â”‚                        â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
      â”‚                          â”‚                        â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          COMPONENTES CLAVE                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend (Widget)
â”œâ”€â”€ chatbot-widget.js â”€â”€â”€â”€â”€â”€> LÃ³gica del chat, comunicaciÃ³n con API
â””â”€â”€ chatbot-widget.css â”€â”€â”€â”€â”€> Estilos, animaciones, responsive

Backend (API)
â”œâ”€â”€ Server Layer
â”‚   â”œâ”€â”€ server.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Express app, routes, middleware
â”‚   â””â”€â”€ Middleware
â”‚       â”œâ”€â”€ rateLimiter â”€â”€â”€> 20 msg/min, 100 msg/hora
â”‚       â””â”€â”€ validator â”€â”€â”€â”€â”€> SanitizaciÃ³n, validaciÃ³n
â”‚
â”œâ”€â”€ Controller Layer
â”‚   â””â”€â”€ chatController â”€â”€â”€â”€> LÃ³gica principal del chat
â”‚
â”œâ”€â”€ Service Layer
â”‚   â”œâ”€â”€ sessionManager â”€â”€â”€â”€> GestiÃ³n de sesiones (UUID)
â”‚   â”œâ”€â”€ intentEngine â”€â”€â”€â”€â”€â”€> DetecciÃ³n de intenciones
â”‚   â””â”€â”€ contextBuilder â”€â”€â”€â”€> Prompts para OpenAI
â”‚
â”œâ”€â”€ Config Layer
â”‚   â””â”€â”€ openai.config â”€â”€â”€â”€â”€> Cliente OpenAI, configuraciÃ³n
â”‚
â””â”€â”€ Data Layer
    â””â”€â”€ portfolio-context â”€> InformaciÃ³n del portafolio


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SISTEMA DE INTENCIONES                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Usuario: "Â¿QuÃ© proyectos has hecho?"
   â”‚
   â–¼
Intent Engine analiza keywords
   â”‚
   â”œâ”€> Detecta: "proyectos" (confianza: 0.85)
   â”‚
   â”œâ”€> Confianza > 0.5?
   â”‚   â””â”€> SÃ â†’ Respuesta predefinida (instantÃ¡nea)
   â”‚
   â””â”€> NO â†’ OpenAI con contexto relevante


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SEGURIDAD MULTICAPA                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½ï¿½â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Capa 1: CORS
   â”œâ”€> Solo dominios permitidos
   â””â”€> Configurado en .env

Capa 2: Rate Limiting
   â”œâ”€> 20 mensajes/minuto por IP
   â””â”€> 100 mensajes/hora por IP

Capa 3: ValidaciÃ³n
   â”œâ”€> Tipo de datos
   â”œâ”€> Longitud (max 1000 chars)
   â””â”€> Formato UUID

Capa 4: SanitizaciÃ³n
   â”œâ”€> XSS protection
   â”œâ”€> SQL injection detection
   â””â”€> HTML entity encoding

Capa 5: Headers
   â”œâ”€> Helmet.js
   â””â”€> Security headers

Capa 6: API Key
   â””â”€> Solo en backend (.env)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GESTIÃ“N DE SESIONES                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Nueva sesiÃ³n:
   â””â”€> UUID generado en frontend â†’ sessionStorage

Primera request:
   â”œâ”€> Backend crea session con UUID
   â”œâ”€> Almacena en Map()
   â””â”€> Retorna sessionId

Requests subsecuentes:
   â”œâ”€> Frontend envÃ­a sessionId
   â”œâ”€> Backend recupera sesiÃ³n
   â”œâ”€> AÃ±ade mensaje al historial
   â””â”€> Mantiene contexto

ExpiraciÃ³n:
   â”œâ”€> 30 minutos de inactividad
   â””â”€> Cleanup automÃ¡tico cada 5 min


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONFIGURACIÃ“N OPENAI                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Modelo: GPT-4 Turbo
Temperature: 0.7
Max Tokens: 500
Frequency Penalty: 0.3
Presence Penalty: 0.3

System Prompt:
   â”œâ”€> Personalidad de Santos
   â”œâ”€> Reglas de comportamiento
   â””â”€> Objetivo y tono

Context:
   â”œâ”€> InformaciÃ³n del portafolio
   â”œâ”€> Historial de conversaciÃ³n
   â””â”€> Contexto relevante segÃºn intenciÃ³n


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ENDPOINTS API                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POST   /api/chat             â†’ Enviar mensaje
GET    /api/health           â†’ Health check
GET    /api/session/:id      â†’ Stats de sesiÃ³n
DELETE /api/session/:id      â†’ Eliminar sesiÃ³n
GET    /                     â†’ Info de la API


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESPUESTAS PREDEFINIDAS                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ventajas:
   â”œâ”€> âš¡ InstantÃ¡neas (sin latencia OpenAI)
   â”œâ”€> ğŸ’° Sin costo de tokens
   â”œâ”€> ğŸ¯ InformaciÃ³n exacta y estructurada
   â””â”€> ğŸ“Š Siempre actualizadas desde portfolio-context.json

Intenciones con respuestas predefinidas:
   â”œâ”€> proyectos
   â”œâ”€> servicios
   â”œâ”€> contacto
   â”œâ”€> tecnologias
   â”œâ”€> experiencia
   â””â”€> sobre_mi

Fallback a OpenAI:
   â””â”€> Cuando confianza < 0.5 o pregunta compleja


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          CARACTERÃSTICAS                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ âœ… Sistema de sesiones persistentes                                        â•‘
â•‘ âœ… Motor de detecciÃ³n de intenciones                                       â•‘
â•‘ âœ… Respuestas predefinidas para consultas comunes                          â•‘
â•‘ âœ… IntegraciÃ³n OpenAI GPT-4 para conversaciones complejas                  â•‘
â•‘ âœ… Rate limiting y protecciÃ³n anti-spam                                    â•‘
â•‘ âœ… ValidaciÃ³n y sanitizaciÃ³n de entrada                                    â•‘
â•‘ âœ… CORS configurado y seguro                                               â•‘
â•‘ âœ… Historial de conversaciÃ³n (Ãºltimos 10 mensajes)                         â•‘
â•‘ âœ… Widget responsive y moderno                                             â•‘
â•‘ âœ… Animaciones suaves                                                      â•‘
â•‘ âœ… Persistencia en localStorage                                            â•‘
â•‘ âœ… Sugerencias rÃ¡pidas                                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
